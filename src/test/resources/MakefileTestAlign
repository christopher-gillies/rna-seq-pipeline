all:	/tmp/test/FIRST_PASS_GENOME_INDEX.OK	/tmp/test/GENOME_LOADED_FIRST_PASS.OK	/tmp/test/SAMPLE2.FIRST_PASS.OK	/tmp/test/SAMPLE1.FIRST_PASS.OK	/tmp/test/GENOME_REMOVED_FIRST_PASS.OK	/tmp/test/SECOND_PASS_GENOME_INDEX.OK	/tmp/test/GENOME_LOADED_SECOND_PASS.OK	/tmp/test/SAMPLE2.SECOND_PASS.OK	/tmp/test/SAMPLE1.SECOND_PASS.OK	/tmp/test/GENOME_REMOVED_SECOND_PASS.OK	
	touch $@.OK

#Generate the genome for first pass alignment
/tmp/test/FIRST_PASS_GENOME_INDEX.OK:	
	/tmp/star --runMode genomeGenerate --genomeDir /tmp/test/genomeDirPassOne --genomeFastaFiles /tmp/reference.fa --runThreadN 11 --sjdbGTFfile /tmp/genecode.gtf --sjdbOverhang 40
	touch $@

#Load the genome into RAM
/tmp/test/GENOME_LOADED_FIRST_PASS.OK:	/tmp/test/FIRST_PASS_GENOME_INDEX.OK	
	/tmp/star --genomeDir /tmp/test/genomeDirPassOne --genomeLoad LoadAndExit
	touch $@

#Run first pass alignment for sample SAMPLE2
/tmp/test/SAMPLE2.FIRST_PASS.OK:	/tmp/test/FIRST_PASS_GENOME_INDEX.OK	/tmp/test/GENOME_LOADED_FIRST_PASS.OK	
	mkdir -p /tmp/test/SAMPLE2_1/
	/tmp/star --genomeDir /tmp/test/genomeDirPassOne --genomeLoad LoadAndKeep --readFilesIn /tmp/fastq3.fastq.gz /tmp/fastq4.fastq.gz --readFilesCommand zcat --outFileNamePrefix /tmp/test/SAMPLE2_1/ --outSJfilterCountUniqueMin 4 2 2 2 --outSJfilterCountTotalMin 4 2 2 2
	touch $@

#Run first pass alignment for sample SAMPLE1
/tmp/test/SAMPLE1.FIRST_PASS.OK:	/tmp/test/FIRST_PASS_GENOME_INDEX.OK	/tmp/test/GENOME_LOADED_FIRST_PASS.OK	
	mkdir -p /tmp/test/SAMPLE1_1/
	/tmp/star --genomeDir /tmp/test/genomeDirPassOne --genomeLoad LoadAndKeep --readFilesIn /tmp/fastq1.fastq.gz /tmp/fastq2.fastq.gz --readFilesCommand zcat --outFileNamePrefix /tmp/test/SAMPLE1_1/ --outSJfilterCountUniqueMin 4 2 2 2 --outSJfilterCountTotalMin 4 2 2 2
	touch $@

#Remove the genome from RAM
/tmp/test/GENOME_REMOVED_FIRST_PASS.OK:	/tmp/test/FIRST_PASS_GENOME_INDEX.OK	/tmp/test/GENOME_LOADED_FIRST_PASS.OK	/tmp/test/SAMPLE2.FIRST_PASS.OK	/tmp/test/SAMPLE1.FIRST_PASS.OK	
	/tmp/star --genomeDir /tmp/test/genomeDirPassOne --genomeLoad Remove
	touch $@

#Generate the genome for second pass alignment
/tmp/test/SECOND_PASS_GENOME_INDEX.OK:	/tmp/test/SAMPLE2.FIRST_PASS.OK	/tmp/test/SAMPLE1.FIRST_PASS.OK	/tmp/test/GENOME_REMOVED_FIRST_PASS.OK	
	/tmp/star --runMode genomeGenerate --genomeDir /tmp/test/genomeDirPassTwo --genomeFastaFiles /tmp/reference.fa --runThreadN 11 --sjdbGTFfile /tmp/genecode.gtf --sjdbFileChrStartEnd /tmp/test/SAMPLE2_1//SJ.out.tab /tmp/test/SAMPLE1_1//SJ.out.tab --sjdbOverhang 40
	touch $@

#Load the second pass genome into RAM
/tmp/test/GENOME_LOADED_SECOND_PASS.OK:	/tmp/test/SECOND_PASS_GENOME_INDEX.OK	
	/tmp/star --genomeDir /tmp/test/genomeDirPassTwo --genomeLoad LoadAndExit
	touch $@

#Run second pass alignment for sample SAMPLE2
/tmp/test/SAMPLE2.SECOND_PASS.OK:	/tmp/test/SECOND_PASS_GENOME_INDEX.OK	/tmp/test/GENOME_LOADED_SECOND_PASS.OK	
	mkdir -p /tmp/test/SAMPLE2/
	/tmp/star --genomeDir /tmp/test/genomeDirPassTwo --genomeLoad LoadAndKeep --readFilesIn /tmp/fastq3.fastq.gz /tmp/fastq4.fastq.gz --readFilesCommand zcat --outFileNamePrefix /tmp/test/SAMPLE2/
	touch $@

#Run second pass alignment for sample SAMPLE1
/tmp/test/SAMPLE1.SECOND_PASS.OK:	/tmp/test/SECOND_PASS_GENOME_INDEX.OK	/tmp/test/GENOME_LOADED_SECOND_PASS.OK	
	mkdir -p /tmp/test/SAMPLE1/
	/tmp/star --genomeDir /tmp/test/genomeDirPassTwo --genomeLoad LoadAndKeep --readFilesIn /tmp/fastq1.fastq.gz /tmp/fastq2.fastq.gz --readFilesCommand zcat --outFileNamePrefix /tmp/test/SAMPLE1/
	touch $@

#Remove the genome from RAM
/tmp/test/GENOME_REMOVED_SECOND_PASS.OK:	/tmp/test/SECOND_PASS_GENOME_INDEX.OK	/tmp/test/GENOME_LOADED_SECOND_PASS.OK	/tmp/test/SAMPLE2.SECOND_PASS.OK	/tmp/test/SAMPLE1.SECOND_PASS.OK	
	/tmp/star --genomeDir /tmp/test/genomeDirPassTwo --genomeLoad Remove
	touch $@

